#!/bin/bash

load etc ami
load etc init # svn...

function status_ami() {
	local agitd="$AMI_MDIR/.git"
	[ -d "$agitd" ] && {
		GIT_DIR="$agitd" GIT_WORK_TREE="$AMI_MDIR" git status -v ;
	}
}

function status_svn() {
	local d="$AMI_SVND"
	for r in $SVN_REPOS; do
		[ -d "$d/$r/.svn" ] && {
			svn status -u "$d/$r" ;
		}
	done
}

function status_git() {
	local agitd="$AMI_GITD/.git"
	[ -d "$agitd" ] && {
		GIT_DIR="$agitd" GIT_WORK_TREE="$AMI_GITD" git status -v ;
	}
}

# main()
case $1 in
	-h)
			echo "# '$AMI_PROG status ami&git' is default"
			echo "Usage: $AMI_PROG status [ami|svn|git|all]" ;;
	all)
			status_ami
			status_svn
			status_git
			;;
	ami)
			status_ami ;;
	svn)
			status_svn ;;
	git)
			status_git ;;
	*)
			status_ami
			status_git ;;
esac
