#!/bin/bash

load etc ami
load etc init # svn...

function status_ami() {
	local agitd="$AMI_MDIR/.git"
	[ -d "$agitd" ] && {
		echo "# $AMI_PROG status ami"
		GIT_DIR="$agitd" GIT_WORK_TREE="$AMI_MDIR" git status -v ;
	}
}

function status_svn() {
	local d="$AMI_SVND"
	[ -d "$d" ] && echo "# $AMI_PROG status svn"
	for r in $SVN_REPOS; do
		[ -d "$d/$r/.svn" ] && {
			svn status -u "$d/$r" ;
		}
	done
}

function status_git() {
	local agitd="$AMI_GITD/.git"
	[ -d "$agitd" ] && {
		echo "# $AMI_PROG status git"
		GIT_DIR="$agitd" GIT_WORK_TREE="$AMI_GITD" git branch -v ;
		GIT_DIR="$agitd" GIT_WORK_TREE="$AMI_GITD" git status -v ;
	}
}

function status_aur() {
	local d="$AMI_AURD"
	local p=${1:-*}
	[ -d "$d" ] && {
		echo "# $AMI_PROG status aur $p";
		cd $d && ls -d1 $p/* 2>/dev/null ; }
}

# main()
case $1 in
	-h)
			echo "# '$AMI_PROG status ami&git' is default"
			echo "Usage: $AMI_PROG status [ami|svn|git|aur [pkg]|all]" ;;
	all)
			status_ami
			status_svn
			status_git
			status_aur
			;;
	ami)
			status_ami ;;
	svn)
			status_svn ;;
	git)
			status_git ;;
	aur)
			shift
			status_aur $* ;;
	*)
			status_ami
			status_git ;;
esac
